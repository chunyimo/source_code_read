## 事件机制

React 提供了一种“顶层注册，事件收集，统一触发”的事件机制。

> - 顶层注册：在 root 元素上绑定一个统一的事件处理函数。
> - 事件收集：事件触发时，构造合成事件对象，按照冒泡或捕获的路径去组件中收集真正的事件处理函数。
> - 统一触发：发生在收集过程之后，对所搜集的事件逐一执行，并共享一个合成事件对象。

> > Note: 1. 绑定到 root 上的事件监听并非我们写组件中事件处理函数。
> > Note: 2. 现在的架构已经不是顶层注册，顶层注册只是委托类型的事件，非委托类型的事件是在目标 target 上注册的。
> > 优势：对事件进行归类，可以在事件产生的任务上包含不同的优先级；提供合成事件对象，解决浏览器的兼容差异问题。

## 关键函数路径

> - createRootImpl ----> listenToAllSupportedEvents
> - setInitialDOMProperties

## 处理流程

> - 绑定在元素上的事件触发后，绑定在 root 上的 listener 会触发，会最终使得组件中的事件被执行。
> - root 上的事件监听 listener 只是相当于一个传令官，按照事件的优先级去安排接下来的工作。
> - 最终将事件交给 runWithPriority 去调度执行。
> - root 上事件监听器的作用:
>   > - 合成事件对象；
>   > - 收集事件执行路径：捕获的路径；冒泡的路径。

## 注意点

> - 事件是委托的，也就是在捕获阶段执行；非委托的，在冒泡阶段执行。
> - root 上绑定的是持有优先级的事件监听。
> - 对于委托事件而言 listener 添加到 rootContainerElement，对于非委托事件，则是添加到目标 target.

## 参考

> - https://segmentfault.com/a/1190000039108951
